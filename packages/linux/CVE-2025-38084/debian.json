{
  "description": "In the Linux kernel, the following vulnerability has been resolved:  mm/hugetlb: unshare page tables during VMA split, not before  Currently, __split_vma() triggers hugetlb page table unsharing through vm_ops->may_split().  This happens before the VMA lock and rmap locks are taken - which is too early, it allows racing VMA-locked page faults in our process and racing rmap walks from other processes to cause page tables to be shared again before we actually perform the split.  Fix it by explicitly calling into the hugetlb unshare logic from __split_vma() in the same place where THP splitting also happens.  At that point, both the VMA and the rmap(s) are write-locked.  An annoying detail is that we can now call into the helper hugetlb_unshare_pmds() from two different locking contexts:  1. from hugetlb_split(), holding:     - mmap lock (exclusively)     - VMA lock     - file rmap lock (exclusively) 2. hugetlb_unshare_all_pmds(), which I think is designed to be able to    call us with only the mmap lock held (in shared mode), but currently    only runs while holding mmap lock (exclusively) and VMA lock  Backporting note: This commit fixes a racy protection that was introduced in commit b30c14cd6102 (\"hugetlb: unshare some PMDs when splitting VMAs\"); that commit claimed to fix an issue introduced in 5.13, but it should actually also go all the way back.  [jannh@google.com: v2]",
  "scope": "local",
  "releases": {
    "bookworm": {
      "status": "resolved",
      "repositories": {
        "bookworm": "6.1.148-1",
        "bookworm-security": "6.1.158-1"
      },
      "fixed_version": "6.1.147-1",
      "urgency": "not yet assigned"
    },
    "bullseye": {
      "status": "resolved",
      "repositories": {
        "bullseye": "5.10.223-1",
        "bullseye-security": "5.10.244-1"
      },
      "fixed_version": "5.10.244-1",
      "urgency": "not yet assigned"
    },
    "forky": {
      "status": "resolved",
      "repositories": {
        "forky": "6.16.12-2"
      },
      "fixed_version": "6.12.35-1",
      "urgency": "not yet assigned"
    },
    "sid": {
      "status": "resolved",
      "repositories": {
        "sid": "6.17.7-2"
      },
      "fixed_version": "6.12.35-1",
      "urgency": "not yet assigned"
    },
    "trixie": {
      "status": "resolved",
      "repositories": {
        "trixie": "6.12.43-1",
        "trixie-security": "6.12.48-1"
      },
      "fixed_version": "6.12.35-1",
      "urgency": "not yet assigned"
    }
  }
}