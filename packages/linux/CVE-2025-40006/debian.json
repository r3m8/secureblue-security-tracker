{
  "description": "In the Linux kernel, the following vulnerability has been resolved:  mm/hugetlb: fix folio is still mapped when deleted  Migration may be raced with fallocating hole.  remove_inode_single_folio will unmap the folio if the folio is still mapped.  However, it's called without folio lock.  If the folio is migrated and the mapped pte has been converted to migration entry, folio_mapped() returns false, and won't unmap it.  Due to extra refcount held by remove_inode_single_folio, migration fails, restores migration entry to normal pte, and the folio is mapped again.  As a result, we triggered BUG in filemap_unaccount_folio.  The log is as follows:  BUG: Bad page cache in process hugetlb  pfn:156c00  page: refcount:515 mapcount:0 mapping:0000000099fef6e1 index:0x0 pfn:0x156c00  head: order:9 mapcount:1 entire_mapcount:1 nr_pages_mapped:0 pincount:0  aops:hugetlbfs_aops ino:dcc dentry name(?):\"my_hugepage_file\"  flags: 0x17ffffc00000c1(locked|waiters|head|node=0|zone=2|lastcpupid=0x1fffff)  page_type: f4(hugetlb)  page dumped because: still mapped when deleted  CPU: 1 UID: 0 PID: 395 Comm: hugetlb Not tainted 6.17.0-rc5-00044-g7aac71907bde-dirty #484 NONE  Hardware name: QEMU Ubuntu 24.04 PC (i440FX + PIIX, 1996), BIOS 0.0.0 02/06/2015  Call Trace:   <TASK>   dump_stack_lvl+0x4f/0x70   filemap_unaccount_folio+0xc4/0x1c0   __filemap_remove_folio+0x38/0x1c0   filemap_remove_folio+0x41/0xd0   remove_inode_hugepages+0x142/0x250   hugetlbfs_fallocate+0x471/0x5a0   vfs_fallocate+0x149/0x380  Hold folio lock before checking if the folio is mapped to avold race with migration.",
  "scope": "local",
  "releases": {
    "bookworm": {
      "status": "resolved",
      "repositories": {
        "bookworm": "6.1.148-1",
        "bookworm-security": "6.1.158-1"
      },
      "fixed_version": "6.1.158-1",
      "urgency": "not yet assigned"
    },
    "bullseye": {
      "status": "open",
      "repositories": {
        "bullseye": "5.10.223-1",
        "bullseye-security": "5.10.244-1"
      },
      "urgency": "not yet assigned"
    },
    "forky": {
      "status": "resolved",
      "repositories": {
        "forky": "6.16.12-2"
      },
      "fixed_version": "6.16.10-1",
      "urgency": "not yet assigned"
    },
    "sid": {
      "status": "resolved",
      "repositories": {
        "sid": "6.17.7-2"
      },
      "fixed_version": "6.16.10-1",
      "urgency": "not yet assigned"
    },
    "trixie": {
      "status": "open",
      "repositories": {
        "trixie": "6.12.43-1",
        "trixie-security": "6.12.48-1"
      },
      "urgency": "not yet assigned"
    }
  }
}